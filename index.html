<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Konvolusi 3x3 (Mean Filter)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:20px;background:#f7f7fb;color:#111}
    h1{font-size:20px;margin-bottom:6px}
    .wrap{display:flex;gap:24px;align-items:flex-start}
    table{border-collapse:collapse}
    td{width:36px;height:36px;border:1px solid #bbb;text-align:center;vertical-align:middle}
    input.cell{width:100%;height:100%;box-sizing:border-box;border:0;background:transparent;text-align:center;font-size:14px}
    .grid-title{font-weight:600;margin-bottom:6px}
    .controls{margin-top:12px}
    button{padding:8px 12px;border-radius:6px;border:0;background:#2b6edf;color:#fff;cursor:pointer}
    button:disabled{opacity:.5}
    .small{font-size:13px;color:#444}
    .output-td{background:#fff}
    .calc{margin-top:12px;padding:10px;background:#fff;border-radius:8px;border:1px solid #e4e6ef}
  </style>
</head>
<body>
  <h1>Konvolusi 3x3 — Mean Filter (7×7 Input → 7×7 Output)</h1>
  <div class="wrap">
    <div>
      <div class="grid-title">Input 7×7 (editable)</div>
      <table id="input-grid"></table>
      <div class="controls">
        <button id="compute">Hitung Konvolusi</button>
        <button id="random">Acak Angka</button>
      </div>
      <div class="small">Isi angka di sel (kosong = 0) atau klik "Acak Angka".</div>
    </div>

    <div>
      <div class="grid-title">Output 7×7</div>
      <table id="output-grid"></table>
      <div class="calc" id="calc-box">Klik "Hitung Konvolusi" untuk melihat hasil perhitungan.</div>
    </div>
  </div>

  <script>
    const rows = 7, cols = 7;
    const inputGrid = document.getElementById('input-grid');
    const outputGrid = document.getElementById('output-grid');
    const calcBox = document.getElementById('calc-box');

    function randomMatrix(){
      return Array.from({length:rows},()=>Array.from({length:cols},()=>Math.floor(Math.random()*4)));
    }

    let defaultMatrix = randomMatrix();

    function makeTable(tableEl, editable=true){
      tableEl.innerHTML='';
      for(let r=0;r<rows;r++){
        const tr=document.createElement('tr');
        for(let c=0;c<cols;c++){
          const td=document.createElement('td');
          td.className = editable ? 'input-td' : 'output-td';
          if(editable){
            const inp=document.createElement('input');
            inp.className='cell';
            inp.dataset.r=r; inp.dataset.c=c;
            inp.value = defaultMatrix[r][c]===0 ? '' : defaultMatrix[r][c];
            inp.addEventListener('input', ()=>{ inp.value = inp.value.replace(/[^0-9\-]/g,''); });
            td.appendChild(inp);
          }else{
            td.textContent='';
          }
          tr.appendChild(td);
        }
        tableEl.appendChild(tr);
      }
    }

    function readInputMatrix(){
      const mat = Array.from({length:rows},()=>Array(cols).fill(0));
      inputGrid.querySelectorAll('input.cell').forEach(inp=>{
        const r=+inp.dataset.r, c=+inp.dataset.c;
        const v = parseInt(inp.value);
        mat[r][c] = isNaN(v) ? 0 : v;
      });
      return mat;
    }

    function padZero(mat){
      const P = Array.from({length:rows+2},()=>Array(cols+2).fill(0));
      for(let r=0;r<rows;r++) for(let c=0;c<cols;c++) P[r+1][c+1]=mat[r][c];
      return P;
    }

    function computeConvolution(mat){
      const P = padZero(mat);
      const out = Array.from({length:rows},()=>Array(cols).fill(0));
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          let s=0;
          for(let u=-1;u<=1;u++) for(let v=-1;v<=1;v++){
            s += P[r+1+u][c+1+v];
          }
          out[r][c] = s / 9;
        }
      }
      return out;
    }

    function showOutput(out){
      const tds = outputGrid.querySelectorAll('td');
      out.forEach((row,r)=>{
        row.forEach((val,c)=>{
          const idx = r*cols + c;
          tds[idx].textContent = Number.isInteger(val) ? val : (Math.round(val*100)/100);
        });
      });
    }

    function showCalculationAt(r,c,mat){
      const P = padZero(mat);
      const centerR=r+1, centerC=c+1;
      let s=0;
      let terms=[];
      for(let u=-1;u<=1;u++) for(let v=-1;v<=1;v++){
        s += P[centerR+u][centerC+v];
        terms.push(P[centerR+u][centerC+v]);
      }
      const avg=s/9;
      calcBox.innerHTML=`<b>S(${r},${c})</b> = (1/9) * [${terms.join(' + ')}] = <b>${s}/9</b> = <b>${Math.round(avg*1000)/1000}</b>`;
    }

    document.getElementById('compute').addEventListener('click', ()=>{
      const mat = readInputMatrix();
      const out = computeConvolution(mat);
      showOutput(out);
      showCalculationAt(2,2,mat);
    });

    document.getElementById('random').addEventListener('click', ()=>{
      defaultMatrix = randomMatrix();
      makeTable(inputGrid,true);
    });

    makeTable(inputGrid,true);
    makeTable(outputGrid,false);
    document.getElementById('compute').click();
  </script>
</body>
</html>
